<div class="notificaciones-container">
  
  <!-- HEADER -->
  <app-card>
    <ng-container card-header>
      <mat-icon>notifications</mat-icon>
      <span>Notificaciones</span>
      <span class="contador" *ngIf="notificacionesNoLeidas.length > 0" 
            [matBadge]="notificacionesNoLeidas.length" 
            matBadgeColor="warn">
      </span>
      
      <button 
        mat-button 
        (click)="recargar()" 
        [disabled]="loading || procesando">
        <mat-icon>refresh</mat-icon>
        Actualizar
      </button>
      
      <button 
        mat-raised-button 
        color="primary"
        (click)="marcarTodasComoLeidas()"
        [disabled]="notificacionesNoLeidas.length === 0 || procesando">
        <mat-icon>done_all</mat-icon>
        Marcar Todas Leídas
      </button>
    </ng-container>

    <!-- LOADING & CONTENIDO -->
    <ng-container card-content>
      <ng-container *ngIf="loading; else notificacionesContent">
        <app-loading-spinner 
          text="Cargando notificaciones...">
        </app-loading-spinner>
      </ng-container>
      
      <ng-template #notificacionesContent>
        <ng-container *ngIf="notificaciones.length === 0; else listaNotificaciones">
          <!-- SIN NOTIFICACIONES -->
          <div class="empty-state">
            <mat-icon>notifications_none</mat-icon>
            <h2>No tienes notificaciones</h2>
            <p>Cuando tengas actividad en tus grupos, las notificaciones aparecerán aquí</p>
          </div>
        </ng-container>
        
        <ng-template #listaNotificaciones>
          <!-- NOTIFICACIONES NO LEÍDAS -->
          <div class="notificaciones-section" *ngIf="notificacionesNoLeidas.length > 0">
            <div class="section-header">
              <mat-icon color="warn">circle</mat-icon>
              No Leídas ({{ notificacionesNoLeidas.length }})
            </div>
            
            <div class="section-content">
              <mat-list class="notificaciones-list">
                <mat-list-item 
                  *ngFor="let notificacion of notificacionesNoLeidas; trackBy: trackByNotificacion"
                  class="notificacion-item no-leida"
                  (click)="verDetalle(notificacion)">
                  
                  <div class="notificacion-content">
                    <div class="notificacion-icon">
                      <mat-icon [color]="obtenerColor(notificacion.tipo)">
                        {{ obtenerIcono(notificacion.tipo) }}
                      </mat-icon>
                    </div>
                    
                    <div class="notificacion-info">
                      <div class="notificacion-header">
                        <h3>{{ obtenerTitulo(notificacion) }}</h3>
                        <span class="fecha">{{ notificacion.fechaCreacion | dateFormat }}</span>
                      </div>
                      
                      <p class="mensaje">{{ notificacion.mensaje }}</p>
                      
                      <div class="notificacion-meta">
                        <mat-chip [color]="obtenerColor(notificacion.tipo)">
                          {{ notificacion.tipo.replace('_', ' ') }}
                        </mat-chip>
                      </div>
                    </div>
                    
                    <div class="notificacion-actions">
                      <button 
                        mat-icon-button 
                        (click)="marcarComoLeida(notificacion); $event.stopPropagation()"
                        [disabled]="procesando"
                        title="Marcar como leída">
                        <mat-icon>done</mat-icon>
                      </button>
                    </div>
                  </div>
                  
                  <mat-divider></mat-divider>
                </mat-list-item>
              </mat-list>
            </div>
          </div>

          <!-- NOTIFICACIONES LEÍDAS -->
          <div class="notificaciones-section" *ngIf="notificacionesLeidas.length > 0">
            <div class="section-header">
              <mat-icon>done</mat-icon>
              Leídas ({{ notificacionesLeidas.length }})
            </div>
            
            <div class="section-content">
              <mat-list class="notificaciones-list">
                <mat-list-item 
                  *ngFor="let notificacion of notificacionesLeidas; trackBy: trackByNotificacion"
                  class="notificacion-item leida"
                  (click)="verDetalle(notificacion)">
                  
                  <div class="notificacion-content">
                    <div class="notificacion-icon">
                      <mat-icon color="disabled">
                        {{ obtenerIcono(notificacion.tipo) }}
                      </mat-icon>
                    </div>
                    
                    <div class="notificacion-info">
                      <div class="notificacion-header">
                        <h3>{{ obtenerTitulo(notificacion) }}</h3>
                        <span class="fecha">{{ notificacion.fechaCreacion | dateFormat }}</span>
                      </div>
                      
                      <p class="mensaje">{{ notificacion.mensaje }}</p>
                      
                      <div class="notificacion-meta">
                        <mat-chip color="primary" disabled>
                          {{ notificacion.tipo.replace('_', ' ') }}
                        </mat-chip>
                      </div>
                    </div>
                  </div>
                  
                  <mat-divider></mat-divider>
                </mat-list-item>
              </mat-list>
            </div>
          </div>
        </ng-template>
      </ng-template>
    </ng-container>
  </app-card>
</div>
