"use strict";(self.webpackChunkdividi_facil_front_end=self.webpackChunkdividi_facil_front_end||[]).push([[614],{5614:(q,m,a)=>{a.r(m),a.d(m,{ListadoPagosComponent:()=>Q});var p=a(2200),h=a(9417),u=a(1413),d=a(6977),_=a(152),P=a(5596),f=a(8834),b=a(1074),M=a(5459),v=a(6850),O=a(3746),x=a(3791),S=a(5084),D=a(3),w=a(9183),y=a(5416),k=a(6471),F=a(6695),s=a(8728),t=a(3664),E=a(1715);let g=(()=>{class n{changes=new u.B;static \u0275fac=function(o){return new(o||n)};static \u0275prov=s.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();const z={provide:g,deps:[[new t.Xx1,new t.kdw,g]],useFactory:function A(n){return n||new g}};let R=(()=>{class n{static \u0275fac=function(o){return new(o||n)};static \u0275mod=t.$C({type:n});static \u0275inj=s.G2t({providers:[z],imports:[E.M]})}return n})();var I=a(9115),T=a(1975),j=a(9947),H=a(4333),G=a(7705),U=a(6437),B=a(3817),N=a(7545),C=a(1782),Y=a(3032);function L(n,c){1&n&&(t.qex(0),t.nrm(1,"app-loading-spinner",8),t.bVm())}function $(n,c){if(1&n){const e=t.RV6();t.qex(0),t.j41(1,"div",9)(2,"mat-icon"),t.EFF(3,"payments"),t.k0s(),t.j41(4,"h2"),t.EFF(5,"No hay pagos registrados"),t.k0s(),t.j41(6,"p"),t.EFF(7),t.k0s(),t.j41(8,"button",5),t.bIt("click",function(){s.eBV(e);const r=t.XpG(2);return s.Njj(r.crearPago())}),t.j41(9,"mat-icon"),t.EFF(10,"add"),t.k0s(),t.EFF(11," Crear Primer Pago "),t.k0s()(),t.bVm()}if(2&n){const e=t.XpG(2);t.R7$(7),t.JRh(e.idGrupoFiltro?"Este grupo no tiene pagos registrados a\xfan":"No tienes pagos registrados a\xfan")}}function X(n,c){1&n&&t.nrm(0,"div",10)}function V(n,c){if(1&n&&t.DNE(0,$,12,1,"ng-container",7)(1,X,1,0,"ng-template",null,1,t.C5r),2&n){const e=t.sdS(2),o=t.XpG();t.Y8G("ngIf",0===o.todosLosPagos.length)("ngIfElse",e)}}let Q=(()=>{class n{fb;pagoService;grupoService;authService;router;route;snackBar;cdr;usuarioService;destroy$=new u.B;loading=!1;procesando=!1;idGrupoFiltro=null;pagosRealizados=[];pagosRecibidos=[];gruposDisponibles=[];usuarioActual;todosLosPagos=[];filtrosForm;idGrupoPreseleccionado="";tabSelectedIndex=0;displayedColumns=["fecha","concepto","receptor","monto","estado","acciones"];usuariosMap=new Map;gruposMap=new Map;pageSize=10;pageSizeOptions=[5,10,25,50];constructor(e,o,r,i,l,K,W,Z,J){this.fb=e,this.pagoService=o,this.grupoService=r,this.authService=i,this.router=l,this.route=K,this.snackBar=W,this.cdr=Z,this.usuarioService=J,this.filtrosForm=this.fb.group({idGrupo:[""],fechaDesde:[""],fechaHasta:[""],estado:[""],busqueda:[""]})}ngOnInit(){this.usuarioActual=this.authService.obtenerUsuario(),this.route.queryParams.pipe((0,d.Q)(this.destroy$)).subscribe(e=>{this.idGrupoFiltro=e.idGrupo||null,this.idGrupoFiltro&&this.filtrosForm.patchValue({idGrupo:this.idGrupoFiltro})}),this.cargarGrupos(),this.cargarPagos(),this.configurarFiltros()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarGrupos(){this.grupoService.getGrupos().pipe((0,d.Q)(this.destroy$)).subscribe({next:e=>{e.exito&&e.data&&(this.gruposDisponibles=e.data.map(o=>({idGrupo:o.idGrupo,nombreGrupo:o.nombreGrupo,modoOperacion:o.modoOperacion,idUsuarioCreador:o.idUsuarioCreador,nombreCreador:o.nombreCreador,fechaCreacion:o.fechaCreacion,descripcion:o.descripcion,cantidadMiembros:o.cantidadMiembros??0,totalGastos:o.totalGastos??0})),this.cdr.markForCheck())},error:e=>{console.error("Error al cargar grupos:",e),this.cdr.markForCheck()}})}cargarPagos(){this.loading=!0,this.cdr.markForCheck(),this.pagoService.obtenerPago(this.filtrosForm.value).pipe((0,d.Q)(this.destroy$)).subscribe({next:o=>{if(this.loading=!1,o.exito&&o.data){const r=Array.isArray(o.data)?o.data:[o.data];this.todosLosPagos=r,this.separarPagos(r),this.cargarNombresUsuarios(r)}this.cdr.markForCheck()},error:o=>{this.loading=!1,console.error("Error al cargar pagos:",o),this.snackBar.open("Error al cargar pagos","Cerrar",{duration:3e3}),this.cdr.markForCheck()}})}separarPagos(e){const o=this.usuarioActual?.idUsuario;this.pagosRealizados=e.filter(r=>r.idPagador===o),this.pagosRecibidos=e.filter(r=>r.idReceptor===o)}configurarFiltros(){this.filtrosForm.valueChanges.pipe((0,_.B)(300),(0,d.Q)(this.destroy$)).subscribe(()=>{this.cargarPagos()})}crearPago(){this.router.navigate(["/alta-pagos"],{queryParams:this.idGrupoPreseleccionado?{idGrupo:this.idGrupoPreseleccionado}:{}})}verDetallePago(e){this.router.navigate(["/detalle-pagos",e.idPago])}confirmarPago(e){const o={...e};e.estado="Completado",e.fechaConfirmacion=(new Date).toISOString(),this.cdr.markForCheck(),this.pagoService.confirmarPago(e.idPago).pipe((0,d.Q)(this.destroy$)).subscribe({next:r=>{r.exito?this.snackBar.open("Pago confirmado exitosamente","Cerrar",{duration:3e3,panelClass:["success-snackbar"]}):(Object.assign(e,o),this.snackBar.open("Error al confirmar pago","Cerrar",{duration:3e3})),this.cdr.markForCheck()},error:r=>{Object.assign(e,o),this.snackBar.open("Error al confirmar pago","Cerrar",{duration:3e3}),this.cdr.markForCheck()}})}rechazarPago(e){this.procesando=!0,this.cdr.markForCheck(),this.pagoService.rechazarPago(e.idPago).pipe((0,d.Q)(this.destroy$)).subscribe(o=>{this.procesando=!1,o.exito&&(this.snackBar.open("Pago rechazado","Cerrar",{duration:3e3,panelClass:["warn-snackbar"]}),this.cargarPagos()),this.cdr.markForCheck()},o=>{this.procesando=!1,console.error("Error al rechazar pago:",o),this.snackBar.open("Error al rechazar pago","Cerrar",{duration:3e3}),this.cdr.markForCheck()})}cargarNombresUsuarios(e){const o=new Set;e.forEach(r=>{o.add(r.idPagador),o.add(r.idReceptor)}),o.forEach(r=>{this.usuarioService.obtenerUsuario(r).subscribe(i=>{this.usuariosMap.set(r,i.exito&&i.data?i.data.nombre:`Usuario ${r.substring(0,8)}`),this.cdr.markForCheck()})})}verDetalle(e){this.router.navigate(["/detalle-pagos",e.idPago])}obtenerNombreUsuario(e){return this.usuariosMap.get(e)||`Usuario ${e.substring(0,8)}`}obtenerNombreGrupo(e){return this.gruposDisponibles.find(r=>r.idGrupo===e)?.nombreGrupo||`Grupo ${e.substring(0,8)}`}recargar(){this.cargarPagos()}trackByPago(e,o){return o.idPago}puedeConfirmarPago(e){return"Pendiente"===e.estado&&e.idReceptor===this.usuarioActual?.idUsuario}puedeRechazarPago(e){return"Pendiente"===e.estado&&e.idReceptor===this.usuarioActual?.idUsuario}obtenerColorEstado(e){switch(e?.toLowerCase()){case"pendiente":return"accent";case"confirmado":return"primary";case"rechazado":return"warn";default:return}}obtenerIconoEstado(e){switch(e){case"Pendiente":return"hourglass_empty";case"Confirmado":return"check_circle";case"Rechazado":return"cancel";default:return"help_outline"}}volver(){window.history.back()}static \u0275fac=function(o){return new(o||n)(t.rXU(h.ok),t.rXU(U.f),t.rXU(B.b),t.rXU(N.u),t.rXU(C.Ix),t.rXU(C.nX),t.rXU(y.UG),t.rXU(G.gRc),t.rXU(Y.o))};static \u0275cmp=t.VBU({type:n,selectors:[["app-listado-pagos"]],decls:19,vars:4,consts:[["pagosContent",""],["listaPagos",""],[1,"pagos-container"],["card-header",""],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click"],["card-content",""],[4,"ngIf","ngIfElse"],["text","Cargando pagos..."],[1,"empty-state"],[1,"pagos-list"]],template:function(o,r){if(1&o){const i=t.RV6();t.j41(0,"div",2)(1,"app-card"),t.qex(2,3),t.j41(3,"mat-icon"),t.EFF(4,"payment"),t.k0s(),t.j41(5,"span"),t.EFF(6),t.k0s(),t.j41(7,"button",4),t.bIt("click",function(){return s.eBV(i),s.Njj(r.recargar())}),t.j41(8,"mat-icon"),t.EFF(9,"refresh"),t.k0s(),t.EFF(10," Actualizar "),t.k0s(),t.j41(11,"button",5),t.bIt("click",function(){return s.eBV(i),s.Njj(r.crearPago())}),t.j41(12,"mat-icon"),t.EFF(13,"add"),t.k0s(),t.EFF(14," Nuevo Pago "),t.k0s(),t.bVm(),t.qex(15,6),t.DNE(16,L,2,0,"ng-container",7)(17,V,3,2,"ng-template",null,0,t.C5r),t.bVm(),t.k0s()()}if(2&o){const i=t.sdS(18);t.R7$(6),t.JRh(r.idGrupoFiltro?"Pagos del Grupo":"Mis Pagos"),t.R7$(),t.Y8G("disabled",r.loading||r.procesando),t.R7$(9),t.Y8G("ngIf",r.loading)("ngIfElse",i)}},dependencies:[p.MD,p.bT,h.X1,P.Hu,f.Hl,f.$z,b.m_,b.An,M.tP,v.RI,O.fS,x.M,S.X6,D.WX,w.D6,y._T,k.YN,F.Ou,R,I.Cn,T.Y,j.i,H.N],styles:['@charset "UTF-8";.listado-container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}@media (max-width: 768px){.listado-container[_ngcontent-%COMP%]{padding:10px}}.pagos-placeholder[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;color:#666}.pagos-placeholder[_ngcontent-%COMP%]   .placeholder-icon[_ngcontent-%COMP%]{font-size:64px;width:64px;height:64px;color:#3f51b5;margin-bottom:16px}.pagos-placeholder[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:16px 0 8px;font-size:1.5rem;font-weight:500;color:#333}.pagos-placeholder[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:8px 0;font-size:1rem;line-height:1.5}.pagos-placeholder[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]:first-of-type{font-weight:500}mat-card[_ngcontent-%COMP%]{box-shadow:0 2px 8px #0000001a;border-radius:8px}mat-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]{margin-bottom:16px}mat-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:1.5rem;color:#333}mat-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#3f51b5}mat-card[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-subtitle[_ngcontent-%COMP%]{color:#666;margin-top:4px}.pagos-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:1rem;min-height:calc(100vh - 200px)}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;flex-wrap:wrap;gap:1rem}.header-section[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.header-section[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{color:#666}.header-section[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin:0;color:#333}.header-section[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1rem;padding:3rem}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666;margin:0}.empty-state[_ngcontent-%COMP%]   .empty-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:3rem;text-align:center}.empty-state[_ngcontent-%COMP%]   .empty-content[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:4rem;width:4rem;height:4rem;color:#ccc;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   .empty-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#666;margin:0 0 .5rem}.empty-state[_ngcontent-%COMP%]   .empty-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#999;margin:0 0 2rem;max-width:400px}.pagos-tabs-card[_ngcontent-%COMP%]{overflow:visible}.pagos-tabs-card[_ngcontent-%COMP%]     .mat-mdc-tab-group .mat-mdc-tab-header{border-bottom:1px solid #e0e0e0}.pagos-tabs-card[_ngcontent-%COMP%]     .mat-mdc-tab-group .mat-mdc-tab-label{min-width:160px}.pagos-tabs-card[_ngcontent-%COMP%]     .mat-mdc-tab-group .mat-mdc-tab-label span{display:flex;align-items:center;gap:.5rem}.tab-content[_ngcontent-%COMP%]{padding:1.5rem 0}.empty-tab[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:2rem;text-align:center}.empty-tab[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:3rem;width:3rem;height:3rem;color:#ccc;margin-bottom:1rem}.empty-tab[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#666;margin:0 0 .5rem}.empty-tab[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#999;margin:0}.pagos-table-container[_ngcontent-%COMP%]{overflow-x:auto;border-radius:8px;border:1px solid #e0e0e0}.pagos-table[_ngcontent-%COMP%]{width:100%;background:#fff}.pagos-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background:#f5f5f5;font-weight:600;color:#333;border-bottom:2px solid #e0e0e0}.pagos-table[_ngcontent-%COMP%]   .clickable-row[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .2s ease}.pagos-table[_ngcontent-%COMP%]   .clickable-row[_ngcontent-%COMP%]:hover{background-color:#f9f9f9}.fecha-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:.9rem}.fecha-cell[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.2rem;width:1.2rem;height:1.2rem;color:#666}.concepto-cell[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.25rem}.concepto-cell[_ngcontent-%COMP%]   .concepto-texto[_ngcontent-%COMP%]{font-weight:500;color:#333}.concepto-cell[_ngcontent-%COMP%]   .grupo-info[_ngcontent-%COMP%]{font-size:.8rem;color:#666;background:#f0f0f0;padding:.2rem .5rem;border-radius:12px;display:inline-block;max-width:fit-content}.usuario-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.usuario-cell[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:1.2rem;width:1.2rem;height:1.2rem;color:#666}.monto-cell[_ngcontent-%COMP%]   .monto-valor[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem;color:#f44336}.monto-cell[_ngcontent-%COMP%]   .monto-valor.recibido[_ngcontent-%COMP%]{color:#4caf50}  .mat-mdc-chip.mat-warn{background-color:#fff3e0;color:#f57c00;border:1px solid #ffcc02}  .mat-mdc-chip.mat-primary{background-color:#e8f5e8;color:#2e7d32;border:1px solid #4caf50}  .mat-mdc-chip.mat-accent{background-color:#ffebee;color:#c62828;border:1px solid #f44336}  .mat-mdc-chip mat-icon{font-size:1rem;width:1rem;height:1rem}.processing-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0000004d;display:flex;align-items:center;justify-content:center;z-index:1000}.processing-overlay[_ngcontent-%COMP%]   .processing-content[_ngcontent-%COMP%]{background:#fff;padding:2rem;border-radius:8px;display:flex;align-items:center;gap:1rem;box-shadow:0 4px 12px #0003}.processing-overlay[_ngcontent-%COMP%]   .processing-content[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500;color:#333}@media (max-width: 1024px){.pagos-container[_ngcontent-%COMP%]{padding:.5rem}.header-section[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.header-section[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{justify-content:center}}@media (max-width: 768px){.header-section[_ngcontent-%COMP%]   .header-left[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.5rem}.pagos-table[_ngcontent-%COMP%]{font-size:.875rem}.pagos-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .pagos-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem}.concepto-cell[_ngcontent-%COMP%]   .grupo-info[_ngcontent-%COMP%]{font-size:.7rem}.monto-cell[_ngcontent-%COMP%]   .monto-valor[_ngcontent-%COMP%]{font-size:1rem}}@media (max-width: 480px){.tab-content[_ngcontent-%COMP%]{padding:1rem 0}.empty-tab[_ngcontent-%COMP%]{padding:1.5rem}.empty-tab[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:2.5rem;width:2.5rem;height:2.5rem}.pagos-table[_ngcontent-%COMP%]   .mat-mdc-row[_ngcontent-%COMP%]{border-bottom:1px solid #e0e0e0}}  .success-snackbar{background:#4caf50!important;color:#fff!important}.spinning[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}[_nghost-%COMP%]{contain:layout style paint;display:block}.dashboard-container[_ngcontent-%COMP%], .stats-container[_ngcontent-%COMP%], .actions-grid[_ngcontent-%COMP%], .timeline-list[_ngcontent-%COMP%]{transform:translateZ(0);will-change:transform}mat-card[_ngcontent-%COMP%]{backface-visibility:hidden}.dashboard-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .3s ease-out}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}'],changeDetection:0})}return n})()}}]);