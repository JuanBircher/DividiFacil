"use strict";(self.webpackChunkdividi_facil_front_end=self.webpackChunkdividi_facil_front_end||[]).push([[755],{755:(Et,b,i)=>{i.r(b),i.d(b,{DetalleGruposComponent:()=>ft});var d=i(2200),g=i(5596),h=i(8834),E=i(1074),p=i(6850),u=i(6471),C=i(9115),k=i(1975),P=i(1997),F=i(5747),D=i(1413),j=i(7468),M=i(6977),v=i(9417),R=i(6751),O=i(3746),I=i(9947),x=i(4333),A=i(8776),T=i(6627),B=i(1275),t=i(3664),r=i(8728),y=i(7705),G=i(1782),$=i(3817),U=i(948),N=i(6437),S=i(2220),X=i(7545),Y=i(5416),V=i(9010),f=i(5404);function L(e,c){if(1&e){const n=t.RV6();t.qex(0),t.j41(1,"app-card",11),t.qex(2,12),t.j41(3,"div",13)(4,"mat-icon",14),t.EFF(5,"error"),t.k0s(),t.j41(6,"h3"),t.EFF(7),t.k0s(),t.j41(8,"button",15),t.bIt("click",function(){r.eBV(n);const a=t.XpG(2);return r.Njj(a.cargarDatosCompletos())}),t.j41(9,"mat-icon"),t.EFF(10,"refresh"),t.k0s(),t.EFF(11," Intentar de nuevo "),t.k0s()(),t.bVm(),t.k0s(),t.bVm()}if(2&e){const n=t.XpG(2);t.R7$(7),t.JRh(n.error)}}function K(e,c){1&e&&(t.j41(0,"mat-chip",42)(1,"mat-icon",43),t.EFF(2,"admin_panel_settings"),t.k0s(),t.EFF(3," Administrador "),t.k0s())}function W(e,c){if(1&e&&(t.j41(0,"p",44),t.EFF(1),t.k0s()),2&e){const n=t.XpG(4);t.R7$(),t.SpI(" ",n.grupo.descripcion," ")}}function J(e,c){if(1&e&&(t.j41(0,"span",26)(1,"mat-icon"),t.EFF(2,"history"),t.k0s(),t.EFF(3),t.k0s()),2&e){const n=t.XpG(4);t.R7$(3),t.SpI(" \xdaltima actividad: ",n.estadisticas.ultimaActividad," ")}}function z(e,c){1&e&&(t.j41(0,"mat-icon"),t.EFF(1,"qr_code"),t.k0s())}function w(e,c){1&e&&(t.j41(0,"mat-icon",57),t.EFF(1,"hourglass_empty"),t.k0s())}function H(e,c){if(1&e){const n=t.RV6();t.j41(0,"div",53)(1,"button",54),t.bIt("click",function(){r.eBV(n);const a=t.XpG(5);return r.Njj(a.invitarMiembro())}),t.DNE(2,z,2,0,"mat-icon",16)(3,w,2,0,"mat-icon",55),t.EFF(4),t.k0s(),t.j41(5,"button",56),t.bIt("click",function(){r.eBV(n);const a=t.XpG(5);return r.Njj(a.toggleFormularioAgregar())}),t.j41(6,"mat-icon"),t.EFF(7,"person_add"),t.k0s(),t.EFF(8," Agregar por Email "),t.k0s()()}if(2&e){const n=t.XpG(5);t.R7$(),t.Y8G("disabled",n.generandoCodigo),t.R7$(),t.Y8G("ngIf",!n.generandoCodigo),t.R7$(),t.Y8G("ngIf",n.generandoCodigo),t.R7$(),t.SpI(" ",n.generandoCodigo?"Generando...":"Generar C\xf3digo"," ")}}function Q(e,c){1&e&&(t.j41(0,"mat-icon"),t.EFF(1,"person_add"),t.k0s())}function Z(e,c){1&e&&(t.j41(0,"mat-icon",57),t.EFF(1,"hourglass_empty"),t.k0s())}function q(e,c){if(1&e){const n=t.RV6();t.j41(0,"mat-card",58)(1,"mat-card-content")(2,"div",59)(3,"mat-form-field",60)(4,"mat-label"),t.EFF(5,"Email del usuario"),t.k0s(),t.j41(6,"input",61),t.mxI("ngModelChange",function(a){r.eBV(n);const _=t.XpG(5);return t.DH7(_.emailNuevoMiembro,a)||(_.emailNuevoMiembro=a),r.Njj(a)}),t.k0s(),t.j41(7,"mat-icon",62),t.EFF(8,"email"),t.k0s()()(),t.j41(9,"div",63)(10,"button",54),t.bIt("click",function(){r.eBV(n);const a=t.XpG(5);return r.Njj(a.agregarMiembroPorEmail())}),t.DNE(11,Q,2,0,"mat-icon",16)(12,Z,2,0,"mat-icon",55),t.EFF(13),t.k0s(),t.j41(14,"button",64),t.bIt("click",function(){r.eBV(n);const a=t.XpG(5);return r.Njj(a.toggleFormularioAgregar())}),t.EFF(15," Cancelar "),t.k0s()()()()}if(2&e){const n=t.XpG(5);t.R7$(6),t.R50("ngModel",n.emailNuevoMiembro),t.Y8G("disabled",n.procesandoAccion),t.R7$(4),t.Y8G("disabled",!n.emailNuevoMiembro.trim()||n.procesandoAccion),t.R7$(),t.Y8G("ngIf",!n.procesandoAccion),t.R7$(),t.Y8G("ngIf",n.procesandoAccion),t.R7$(),t.SpI(" ",n.procesandoAccion?"Agregando...":"Agregar Miembro"," "),t.R7$(),t.Y8G("disabled",n.procesandoAccion)}}function tt(e,c){if(1&e){const n=t.RV6();t.j41(0,"div",77)(1,"button",78)(2,"mat-icon"),t.EFF(3,"more_vert"),t.k0s()(),t.j41(4,"mat-menu",null,3)(6,"button",7),t.bIt("click",function(){r.eBV(n);const a=t.XpG().$implicit,_=t.XpG(5);return r.Njj(_.cambiarRol(a.idMiembro,"Admin"))}),t.j41(7,"mat-icon"),t.EFF(8,"admin_panel_settings"),t.k0s(),t.EFF(9," Hacer Administrador "),t.k0s(),t.nrm(10,"mat-divider"),t.j41(11,"button",79),t.bIt("click",function(){r.eBV(n);const a=t.XpG().$implicit,_=t.XpG(5);return r.Njj(_.eliminarMiembro(a.idMiembro))}),t.j41(12,"mat-icon"),t.EFF(13,"remove_circle"),t.k0s(),t.EFF(14," Eliminar del Grupo "),t.k0s()()()}if(2&e){const n=t.sdS(5);t.R7$(),t.Y8G("matMenuTriggerFor",n)}}function nt(e,c){1&e&&(t.j41(0,"div",80)(1,"mat-chip",22)(2,"mat-icon",43),t.EFF(3,"star"),t.k0s(),t.EFF(4," T\xfa "),t.k0s()())}function et(e,c){if(1&e&&(t.j41(0,"mat-card",65)(1,"mat-card-content")(2,"div",66)(3,"div",67)(4,"mat-icon",68),t.EFF(5,"person"),t.k0s()(),t.j41(6,"div",69)(7,"h4"),t.EFF(8),t.k0s(),t.j41(9,"p",70),t.EFF(10),t.k0s(),t.j41(11,"p",71)(12,"mat-icon",72),t.EFF(13,"schedule"),t.k0s(),t.EFF(14),t.nI1(15,"dateFormat"),t.k0s()(),t.j41(16,"div",73)(17,"mat-chip",74)(18,"mat-icon",43),t.EFF(19),t.k0s(),t.EFF(20),t.k0s()(),t.DNE(21,tt,15,1,"div",75)(22,nt,5,0,"div",76),t.k0s()()()),2&e){const n=c.$implicit,o=t.XpG(5);t.R7$(8),t.JRh(n.nombreUsuario),t.R7$(2),t.JRh(n.emailUsuario),t.R7$(4),t.SpI(" Unido ",t.bMT(15,8,n.fechaUnion)," "),t.R7$(3),t.Y8G("color",o.getRolColor(n.rol)),t.R7$(2),t.JRh(o.getRolIcon(n.rol)),t.R7$(),t.SpI(" ",n.rol," "),t.R7$(),t.Y8G("ngIf",o.esAdministrador&&"Admin"!==n.rol),t.R7$(),t.Y8G("ngIf",n.idUsuario===(null==o.usuarioActual?null:o.usuarioActual.idUsuario))}}function ot(e,c){if(1&e&&(t.j41(0,"div",81)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title")(4,"mat-icon"),t.EFF(5,"analytics"),t.k0s(),t.EFF(6," Estad\xedsticas de Miembros "),t.k0s()(),t.j41(7,"mat-card-content")(8,"div",82)(9,"div",83)(10,"div",84),t.EFF(11),t.k0s(),t.j41(12,"div",85),t.EFF(13,"Total Miembros"),t.k0s()(),t.j41(14,"div",83)(15,"div",84),t.EFF(16),t.k0s(),t.j41(17,"div",85),t.EFF(18,"Administradores"),t.k0s()(),t.j41(19,"div",83)(20,"div",84),t.EFF(21),t.k0s(),t.j41(22,"div",85),t.EFF(23,"Miembros"),t.k0s()()()()()()),2&e){const n=t.XpG(5);t.R7$(11),t.JRh(n.grupo.miembros.length),t.R7$(5),t.SpI(" ",n.contarMiembrosPorRol("Admin")," "),t.R7$(5),t.SpI(" ",n.contarMiembrosPorRol("Miembro")," ")}}function at(e,c){1&e&&(t.j41(0,"div",86)(1,"mat-card")(2,"mat-card-content")(3,"div",87)(4,"mat-icon",88),t.EFF(5,"info"),t.k0s(),t.j41(6,"div",89)(7,"h4"),t.EFF(8,"\xbfC\xf3mo agregar miembros?"),t.k0s(),t.j41(9,"p")(10,"strong"),t.EFF(11,"Opci\xf3n 1:"),t.k0s(),t.EFF(12," Genera un c\xf3digo de acceso y comp\xe1rtelo"),t.k0s(),t.j41(13,"p")(14,"strong"),t.EFF(15,"Opci\xf3n 2:"),t.k0s(),t.EFF(16," Agrega directamente por email si ya tienen cuenta"),t.k0s()()()()()())}function rt(e,c){if(1&e&&(t.j41(0,"div",45)(1,"div",46)(2,"h2")(3,"mat-icon"),t.EFF(4,"group"),t.k0s(),t.EFF(5),t.k0s(),t.DNE(6,H,9,4,"div",47),t.k0s(),t.DNE(7,q,16,7,"mat-card",48),t.j41(8,"div",49),t.DNE(9,et,23,10,"mat-card",50),t.k0s(),t.DNE(10,ot,24,3,"div",51)(11,at,17,0,"div",52),t.k0s()),2&e){const n=t.XpG(4);t.R7$(5),t.SpI(" Miembros del Grupo (",n.grupo.miembros.length||0,") "),t.R7$(),t.Y8G("ngIf",n.esAdministrador),t.R7$(),t.Y8G("ngIf",n.mostrarFormularioAgregar&&n.esAdministrador),t.R7$(2),t.Y8G("ngForOf",n.grupo.miembros)("ngForTrackBy",n.trackByMiembroId),t.R7$(),t.Y8G("ngIf",null==n.grupo.miembros?null:n.grupo.miembros.length),t.R7$(),t.Y8G("ngIf",n.esAdministrador)}}function it(e,c){if(1&e&&(t.j41(0,"span",101),t.EFF(1),t.nI1(2,"currencyFormat"),t.k0s()),2&e){const n=t.XpG().$implicit;t.R7$(),t.SpI(" ",t.bMT(2,1,n.monto)," ")}}function ct(e,c){if(1&e&&(t.j41(0,"div",95)(1,"div",96)(2,"mat-icon"),t.EFF(3),t.k0s()(),t.j41(4,"div",97)(5,"div",98)(6,"h4"),t.EFF(7),t.k0s(),t.DNE(8,it,3,3,"span",99),t.k0s(),t.j41(9,"p",100),t.EFF(10),t.nI1(11,"dateFormat"),t.k0s()()()),2&e){const n=c.$implicit;t.R7$(),t.Y8G("ngClass",n.color),t.R7$(2),t.JRh(n.icono),t.R7$(4),t.JRh(n.descripcion),t.R7$(),t.Y8G("ngIf",n.monto),t.R7$(2),t.Lme(" ",n.usuario," \u2022 ",t.bMT(11,6,n.fecha)," ")}}function st(e,c){if(1&e&&(t.j41(0,"div",93),t.DNE(1,ct,12,8,"div",94),t.k0s()),2&e){const n=t.XpG(5);t.R7$(),t.Y8G("ngForOf",n.actividadReciente)("ngForTrackBy",n.trackByActividadId)}}function _t(e,c){1&e&&(t.j41(0,"div",102)(1,"mat-icon"),t.EFF(2,"timeline"),t.k0s(),t.j41(3,"h3"),t.EFF(4,"No hay actividad reciente"),t.k0s(),t.j41(5,"p"),t.EFF(6,"Cuando se realicen gastos aparecer\xe1n aqu\xed"),t.k0s()())}function lt(e,c){if(1&e){const n=t.RV6();t.j41(0,"div",45)(1,"div",46)(2,"h2")(3,"mat-icon"),t.EFF(4,"timeline"),t.k0s(),t.EFF(5," Actividad Reciente "),t.k0s()(),t.DNE(6,st,2,2,"div",90)(7,_t,7,0,"ng-template",null,4,t.C5r),t.j41(9,"div",91)(10,"button",92),t.bIt("click",function(){r.eBV(n);const a=t.XpG(4);return r.Njj(a.verHistorialGastos())}),t.j41(11,"mat-icon"),t.EFF(12,"receipt"),t.k0s(),t.EFF(13," Ver Todos los Gastos "),t.k0s()()()}if(2&e){const n=t.sdS(8),o=t.XpG(4);t.R7$(6),t.Y8G("ngIf",o.actividadReciente.length>0)("ngIfElse",n)}}function mt(e,c){if(1&e&&t.nrm(0,"app-configuraciones",103),2&e){const n=t.XpG(4);t.Y8G("grupo",n.grupo)("esAdministrador",n.esAdministrador)}}function gt(e,c){if(1&e&&(t.qex(0),t.j41(1,"app-card",17),t.qex(2,12),t.j41(3,"div",18)(4,"div",19)(5,"div",20)(6,"h1",21),t.EFF(7),t.k0s(),t.j41(8,"mat-chip-set")(9,"mat-chip",22),t.EFF(10),t.k0s(),t.DNE(11,K,4,0,"mat-chip",23),t.k0s()(),t.DNE(12,W,2,1,"p",24),t.j41(13,"div",25)(14,"span",26)(15,"mat-icon"),t.EFF(16,"group"),t.k0s(),t.EFF(17),t.k0s(),t.j41(18,"span",26)(19,"mat-icon"),t.EFF(20,"calendar_today"),t.k0s(),t.EFF(21),t.nI1(22,"dateFormat"),t.k0s(),t.DNE(23,J,4,1,"span",27),t.k0s()()(),t.bVm(),t.k0s(),t.j41(24,"div",28)(25,"app-card",29),t.qex(26,12),t.j41(27,"div",30)(28,"div",31)(29,"mat-icon"),t.EFF(30,"receipt"),t.k0s()(),t.j41(31,"div",32)(32,"h3"),t.EFF(33),t.k0s(),t.j41(34,"p"),t.EFF(35,"Total Gastos"),t.k0s()()(),t.bVm(),t.k0s(),t.j41(36,"app-card",29),t.qex(37,12),t.j41(38,"div",30)(39,"div",33)(40,"mat-icon"),t.EFF(41,"account_balance_wallet"),t.k0s()(),t.j41(42,"div",32)(43,"h3"),t.EFF(44),t.nI1(45,"currencyFormat"),t.k0s(),t.j41(46,"p"),t.EFF(47,"Monto Total"),t.k0s()()(),t.bVm(),t.k0s(),t.j41(48,"app-card",29),t.qex(49,12),t.j41(50,"div",30)(51,"div",34)(52,"mat-icon"),t.EFF(53,"trending_up"),t.k0s()(),t.j41(54,"div",32)(55,"h3"),t.EFF(56),t.nI1(57,"currencyFormat"),t.k0s(),t.j41(58,"p"),t.EFF(59,"Gasto Promedio"),t.k0s()()(),t.bVm(),t.k0s(),t.j41(60,"app-card",29),t.qex(61,12),t.j41(62,"div",30)(63,"div",35)(64,"mat-icon"),t.EFF(65,"check_circle"),t.k0s()(),t.j41(66,"div",32)(67,"h3"),t.EFF(68),t.k0s(),t.j41(69,"p"),t.EFF(70,"Este Mes"),t.k0s()()(),t.bVm(),t.k0s()(),t.j41(71,"app-card",36)(72,"mat-tab-group",37)(73,"mat-tab",38),t.DNE(74,rt,12,7,"ng-template",39),t.k0s(),t.j41(75,"mat-tab",40),t.DNE(76,lt,14,2,"ng-template",39),t.k0s(),t.j41(77,"mat-tab",41),t.DNE(78,mt,1,2,"ng-template",39),t.k0s()()(),t.bVm()),2&e){const n=t.XpG(3);t.R7$(7),t.JRh(n.grupo.nombreGrupo),t.R7$(3),t.SpI(" ",n.grupo.modoOperacion," "),t.R7$(),t.Y8G("ngIf",n.esAdministrador),t.R7$(),t.Y8G("ngIf",n.grupo.descripcion),t.R7$(5),t.SpI(" ",n.grupo.miembros.length||0," miembros "),t.R7$(4),t.SpI(" Creado ",t.bMT(22,11,n.grupo.fechaCreacion)," "),t.R7$(2),t.Y8G("ngIf",n.estadisticas.ultimaActividad),t.R7$(10),t.JRh(n.estadisticas.totalGastos),t.R7$(11),t.JRh(t.bMT(45,13,n.grupo.totalGastos)),t.R7$(12),t.JRh(t.bMT(57,15,n.estadisticas.gastoPromedio)),t.R7$(12),t.JRh(n.estadisticas.gastosEsteMes)}}function dt(e,c){if(1&e&&t.DNE(0,gt,79,17,"ng-container",16),2&e){const n=t.XpG(2);t.Y8G("ngIf",n.grupo)}}function pt(e,c){if(1&e&&(t.j41(0,"div",9),t.DNE(1,L,12,1,"ng-container",10)(2,dt,1,1,"ng-template",null,2,t.C5r),t.k0s()),2&e){const n=t.sdS(3),o=t.XpG();t.R7$(),t.Y8G("ngIf",o.error)("ngIfElse",n)}}function ut(e,c){1&e&&t.nrm(0,"app-loading-spinner",104)}function Ct(e,c){if(1&e){const n=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){r.eBV(n);const a=t.XpG();return r.Njj(a.editarGrupo())}),t.j41(1,"mat-icon"),t.EFF(2,"edit"),t.k0s(),t.EFF(3," Editar Grupo "),t.k0s()}}function Mt(e,c){if(1&e){const n=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){r.eBV(n);const a=t.XpG();return r.Njj(a.invitarMiembro())}),t.j41(1,"mat-icon"),t.EFF(2,"person_add"),t.k0s(),t.EFF(3," Generar C\xf3digo "),t.k0s()}}function vt(e,c){if(1&e){const n=t.RV6();t.j41(0,"div",105),t.bIt("click",function(){r.eBV(n);const a=t.XpG();return r.Njj(a.cerrarModalCodigo())}),t.j41(1,"div",106),t.bIt("click",function(a){return r.eBV(n),r.Njj(a.stopPropagation())}),t.j41(2,"div",107)(3,"h2")(4,"mat-icon"),t.EFF(5,"qr_code"),t.k0s(),t.EFF(6," C\xf3digo de Acceso Generado "),t.k0s(),t.j41(7,"button",108),t.bIt("click",function(){r.eBV(n);const a=t.XpG();return r.Njj(a.cerrarModalCodigo())}),t.j41(8,"mat-icon"),t.EFF(9,"close"),t.k0s()()(),t.j41(10,"div",109)(11,"div",110)(12,"div",111),t.EFF(13,"Tu c\xf3digo de acceso:"),t.k0s(),t.j41(14,"div",112),t.EFF(15),t.k0s(),t.j41(16,"div",113)(17,"mat-icon"),t.EFF(18,"info"),t.k0s(),t.EFF(19," Comparte este c\xf3digo para que otros puedan unirse al grupo "),t.k0s()(),t.j41(20,"div",114)(21,"h4"),t.EFF(22,"\xbfC\xf3mo funciona?"),t.k0s(),t.j41(23,"ol")(24,"li"),t.EFF(25,"Comparte este c\xf3digo con las personas que quieres invitar"),t.k0s(),t.j41(26,"li"),t.EFF(27,'Ellas deben ir a "Unirse a Grupo" en la app'),t.k0s(),t.j41(28,"li"),t.EFF(29,"Ingresar el c\xf3digo y autom\xe1ticamente se unir\xe1n"),t.k0s()()()(),t.j41(30,"div",115)(31,"button",116),t.bIt("click",function(){r.eBV(n);const a=t.XpG();return r.Njj(a.cerrarModalCodigo())}),t.EFF(32," Cerrar "),t.k0s(),t.j41(33,"button",56),t.bIt("click",function(){r.eBV(n);const a=t.XpG();return r.Njj(a.copiarCodigo())}),t.j41(34,"mat-icon"),t.EFF(35,"content_copy"),t.k0s(),t.EFF(36," Copiar C\xf3digo "),t.k0s(),t.j41(37,"button",15),t.bIt("click",function(){r.eBV(n);const a=t.XpG();return r.Njj(a.compartirCodigo())}),t.j41(38,"mat-icon"),t.EFF(39,"share"),t.k0s(),t.EFF(40," Compartir "),t.k0s()()()()}if(2&e){const n=t.XpG();t.R7$(15),t.JRh(n.codigoAccesoActual)}}let ft=(()=>{class e{route;router;grupoService;gastoService;pagoService;balanceService;authService;snackBar;cdr;destroy$=new D.B;loading=!0;error=null;idGrupo="";grupo=null;usuarioActual;miembros=[];estadisticas={totalGastos:0,totalMiembros:0,gastoPromedio:0,gastosEsteMes:0,ultimaActividad:""};actividadReciente=[];balanceGrupo=null;esAdministrador=!1;puedeEditarGrupo=!1;puedeInvitarMiembros=!1;mostrarFormularioAgregar=!1;emailNuevoMiembro="";procesandoAccion=!1;codigoAccesoActual=null;generandoCodigo=!1;mostrarModalCodigo=!1;constructor(n,o,a,_,s,l,m,bt,ht){this.route=n,this.router=o,this.grupoService=a,this.gastoService=_,this.pagoService=s,this.balanceService=l,this.authService=m,this.snackBar=bt,this.cdr=ht}ngOnInit(){this.usuarioActual=this.authService.obtenerUsuario(),this.idGrupo=this.route.snapshot.paramMap.get("idGrupo")||"",console.log("\u{1f50d} ID Grupo obtenido de ruta:",this.idGrupo),this.idGrupo?this.cargarDatosCompletos():(this.error="ID de grupo no v\xe1lido",this.loading=!1)}cargarDatosCompletos(){this.loading=!0,this.error=null,this.cdr.markForCheck(),this.grupoService.obtenerGrupoConMiembros(this.idGrupo).subscribe({next:n=>{console.log("\u{1f4e6} Respuesta grupo:",n),n.exito&&n.data?(this.grupo=n.data,this.miembros=n.data.miembros||[],this.configurarPermisos(),console.log("\u{1f465} Grupo cargado:",this.grupo)):this.error=n.mensaje||"Error al cargar el grupo",this.loading=!1,this.cdr.markForCheck()},error:n=>{console.error("\u274c Error cargando grupo:",n),this.error="Error al cargar el grupo",this.loading=!1,this.cdr.markForCheck()}})}configurarPermisos(){if(!this.grupo||!this.usuarioActual)return;const n=this.grupo.miembros.find(o=>o.idUsuario===this.usuarioActual.idUsuario);n&&(this.esAdministrador="Administrador"===n.rol,this.puedeEditarGrupo=this.esAdministrador,this.puedeInvitarMiembros=this.esAdministrador)}cargarDatosAdicionales(){(0,j.p)({balance:this.balanceService.obtenerBalanceGrupo(this.idGrupo),gastos:this.gastoService.obtenerGastosPorGrupo(this.idGrupo),pagos:this.pagoService.obtenerPagosPorGrupo(this.idGrupo),movimientos:this.balanceService.obtenerHistorialMovimientos(this.idGrupo)}).pipe((0,M.Q)(this.destroy$)).subscribe({next:n=>{this.loading=!1,n.balance.exito&&n.balance.data&&(this.balanceGrupo=n.balance.data);const o=n.gastos&&n.gastos.data?n.gastos.data:[],a=n.pagos&&n.pagos.data?n.pagos.data:[];this.calcularEstadisticas(o,a),this.procesarActividadReciente(o,a,n.movimientos&&n.movimientos.data?n.movimientos.data:[])},error:n=>{this.loading=!1,this.error="Error al cargar datos adicionales",console.error("Error cargando datos adicionales:",n)}})}calcularEstadisticas(n,o){const a=new Date,_=a.getMonth(),s=a.getFullYear();this.estadisticas={totalGastos:n.length,totalMiembros:this.grupo?.miembros.length||0,gastoPromedio:n.length>0?n.reduce((l,m)=>l+m.monto,0)/n.length:0,gastosEsteMes:n.filter(l=>{const m=new Date(l.fechaCreacion);return m.getMonth()===_&&m.getFullYear()===s}).length,ultimaActividad:this.obtenerUltimaActividad(n,o)},this.grupo&&(this.grupo.totalGastos=n.reduce((l,m)=>l+m.monto,0))}obtenerUltimaActividad(n,o){const a=[...n.map(s=>new Date(s.fechaCreacion)),...o.map(s=>new Date(s.fechaCreacion))];return 0===a.length?"":new Date(Math.max(...a.map(s=>s.getTime()))).toISOString()}procesarActividadReciente(n,o,a){const _=[];n.slice(0,5).forEach(s=>{_.push({id:s.idGasto,tipo:"gasto",descripcion:s.descripcion,usuario:s.nombreMiembroPagador||"Usuario",fecha:s.fechaCreacion,monto:s.monto,icono:"receipt",color:"warn"})}),o.slice(0,5).forEach(s=>{_.push({id:s.idPago,tipo:"pago",descripcion:`Pago: ${s.concepto||"Sin concepto"}`,usuario:s.nombrePagador||"Usuario",fecha:s.fechaCreacion,monto:s.monto,icono:"payment",color:"Completado"===s.estado?"primary":"accent"})}),this.actividadReciente=_.sort((s,l)=>new Date(l.fecha).getTime()-new Date(s.fecha).getTime()).slice(0,10)}cambiarRolMiembro(n,o){this.grupoService.cambiarRolMiembro(this.idGrupo,n,o).subscribe({next:a=>{a.exito?(this.snackBar.open("Rol actualizado exitosamente","Cerrar",{duration:3e3}),this.cargarDatosCompletos()):this.snackBar.open(a.mensaje||"Error al cambiar rol","Cerrar",{duration:3e3})},error:a=>{console.error("Error al cambiar rol:",a),this.snackBar.open("Error al cambiar rol","Cerrar",{duration:3e3})}})}invitarMiembro(){if(this.emailNuevoMiembro.trim()){const n={emailInvitado:this.emailNuevoMiembro.trim()};this.grupoService.agregarMiembro(this.idGrupo,n).subscribe({next:o=>{o.exito?(this.snackBar.open("Invitaci\xf3n enviada exitosamente","Cerrar",{duration:3e3}),this.emailNuevoMiembro="",this.cargarDatosCompletos()):this.snackBar.open(o.mensaje||"Error al enviar invitaci\xf3n","Cerrar",{duration:3e3})},error:o=>{console.error("Error al enviar invitaci\xf3n:",o),this.snackBar.open("Error al enviar invitaci\xf3n","Cerrar",{duration:3e3})}})}}copiarCodigo(){this.codigoAccesoActual&&navigator.clipboard.writeText(this.codigoAccesoActual).then(()=>{this.snackBar.open("C\xf3digo copiado al portapapeles","Cerrar",{duration:2e3})}).catch(()=>{this.snackBar.open("Error al copiar c\xf3digo","Cerrar",{duration:2e3})})}compartirCodigo(){if(!this.codigoAccesoActual)return;const n=this.grupo?.nombreGrupo||"el grupo",o=`\xa1Te invito a unirte al grupo "${n}"!\n\nC\xf3digo de acceso: ${this.codigoAccesoActual}\n\nIngresa este c\xf3digo en DividiF\xe1cil para unirte.`;navigator.share?navigator.share({title:`Invitaci\xf3n a ${n}`,text:o}):navigator.clipboard.writeText(o).then(()=>{this.snackBar.open("Mensaje de invitaci\xf3n copiado","Cerrar",{duration:3e3})})}cerrarModalCodigo(){this.mostrarModalCodigo=!1,this.codigoAccesoActual=null}eliminarMiembro(n){confirm("\xbfEst\xe1s seguro de eliminar este miembro?")&&this.grupoService.eliminarMiembro(this.idGrupo,n).pipe((0,M.Q)(this.destroy$)).subscribe({next:o=>{o.exito&&(this.snackBar.open("Miembro eliminado correctamente","Cerrar",{duration:3e3}),this.cargarDatosCompletos())},error:o=>{this.snackBar.open("Error al eliminar miembro","Cerrar",{duration:3e3})}})}cambiarRol(n,o){this.grupoService.cambiarRolMiembro(this.idGrupo,n,o).pipe((0,M.Q)(this.destroy$)).subscribe({next:a=>{a.exito&&(this.snackBar.open("Rol actualizado correctamente","Cerrar",{duration:3e3}),this.cargarDatosCompletos())},error:a=>{this.snackBar.open("Error al cambiar rol","Cerrar",{duration:3e3})}})}toggleFormularioAgregar(){this.mostrarFormularioAgregar=!this.mostrarFormularioAgregar,this.emailNuevoMiembro=""}agregarMiembroPorEmail(){this.emailNuevoMiembro.trim()?(this.procesandoAccion=!0,this.grupoService.agregarMiembro(this.idGrupo,{emailInvitado:this.emailNuevoMiembro.trim()}).pipe((0,M.Q)(this.destroy$)).subscribe({next:n=>{this.procesandoAccion=!1,n.exito?(this.snackBar.open("Miembro agregado correctamente","Cerrar",{duration:3e3}),this.emailNuevoMiembro="",this.mostrarFormularioAgregar=!1,this.cargarDatosCompletos()):this.snackBar.open(n.mensaje||"Error al agregar miembro","Cerrar",{duration:3e3})},error:n=>{this.procesandoAccion=!1,this.snackBar.open("Error al agregar miembro","Cerrar",{duration:3e3})}})):this.snackBar.open("Ingrese un email v\xe1lido","Cerrar",{duration:3e3})}editarGrupo(){this.router.navigate(["/grupos/alta"],{queryParams:{id:this.idGrupo,modo:"editar"}})}crearGasto(){this.router.navigate(["/gastos/alta"],{queryParams:{idGrupo:this.idGrupo}})}verHistorialGastos(){this.router.navigate(["/gastos"],{queryParams:{idGrupo:this.idGrupo}})}verBalanceGrupo(){this.router.navigate(["/balances/grupo",this.idGrupo])}verPagosGrupo(){this.router.navigate(["/listado-pagos"],{queryParams:{idGrupo:this.idGrupo}})}crearPagoRapido(){this.router.navigate(["/alta-pagos"],{queryParams:{idGrupo:this.idGrupo}})}refrescarDatos(){this.cargarDatosCompletos()}getRolColor(n){return"Administrador"===n?"primary":"accent"}getRolIcon(n){return"Administrador"===n?"admin_panel_settings":"person"}trackByMiembroId(n,o){return o.idMiembro}trackByActividadId(n,o){return o.id}contarMiembrosPorRol(n){return this.grupo&&this.grupo.miembros?this.grupo.miembros.filter(o=>o.rol===n).length:0}confirmarAccion(n){console.log("Confirmar acci\xf3n para miembro:",n)}static \u0275fac=function(o){return new(o||e)(t.rXU(G.nX),t.rXU(G.Ix),t.rXU($.b),t.rXU(U.Y),t.rXU(N.f),t.rXU(S.o),t.rXU(X.u),t.rXU(Y.UG),t.rXU(y.gRc))};static \u0275cmp=t.VBU({type:e,selectors:[["app-detalle-grupos"]],decls:13,vars:5,consts:[["loadingTemplate",""],["menuAcciones","matMenu"],["mainContent",""],["menuMiembro","matMenu"],["noActividad",""],["class","detalle-grupo-container",4,"ngIf","ngIfElse"],["mat-menu-item","",3,"click",4,"ngIf"],["mat-menu-item","",3,"click"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"detalle-grupo-container"],[4,"ngIf","ngIfElse"],["cardClass","error-card"],["card-content",""],[1,"error-content"],[1,"error-icon"],["mat-raised-button","","color","primary",3,"click"],[4,"ngIf"],["cardClass","header-card"],[1,"header-content"],[1,"grupo-info"],[1,"grupo-title-section"],[1,"grupo-nombre"],["color","accent","selected",""],["color","primary","selected","",4,"ngIf"],["class","grupo-descripcion",4,"ngIf"],[1,"grupo-meta"],[1,"meta-item"],["class","meta-item",4,"ngIf"],[1,"estadisticas-grid"],[1,"stat-card"],[1,"stat-content"],[1,"stat-icon","primary"],[1,"stat-info"],[1,"stat-icon","accent"],[1,"stat-icon","warn"],[1,"stat-icon","success"],[1,"main-content-card"],["animationDuration","300ms"],["label","Miembros"],["matTabContent",""],["label","Actividad Reciente"],["label","Configuraci\xf3n"],["color","primary","selected",""],["matChipAvatar",""],[1,"grupo-descripcion"],[1,"tab-content"],[1,"tab-header"],["class","acciones-miembros",4,"ngIf"],["class","formulario-agregar",4,"ngIf"],[1,"miembros-grid"],["class","miembro-card",4,"ngFor","ngForOf","ngForTrackBy"],["class","estadisticas-miembros",4,"ngIf"],["class","ayuda-codigo",4,"ngIf"],[1,"acciones-miembros"],["mat-raised-button","","color","primary",3,"click","disabled"],["class","spinning",4,"ngIf"],["mat-stroked-button","","color","accent",3,"click"],[1,"spinning"],[1,"formulario-agregar"],[1,"form-row"],["appearance","outline",1,"full-width"],["matInput","","type","email","placeholder","usuario@ejemplo.com",3,"ngModelChange","ngModel","disabled"],["matSuffix",""],[1,"form-actions"],["mat-button","",3,"click","disabled"],[1,"miembro-card"],[1,"miembro-content"],[1,"miembro-avatar"],[1,"avatar-icon"],[1,"miembro-info"],[1,"email"],[1,"fecha-union"],[1,"small-icon"],[1,"miembro-rol"],["selected","",3,"color"],["class","miembro-acciones",4,"ngIf"],["class","usuario-actual",4,"ngIf"],[1,"miembro-acciones"],["mat-icon-button","","matTooltip","Gestionar miembro",3,"matMenuTriggerFor"],["mat-menu-item","",1,"danger-item",3,"click"],[1,"usuario-actual"],[1,"estadisticas-miembros"],[1,"stats-grid"],[1,"stat-item"],[1,"stat-number"],[1,"stat-label"],[1,"ayuda-codigo"],[1,"ayuda-content"],["color","primary"],[1,"ayuda-texto"],["class","actividad-timeline",4,"ngIf","ngIfElse"],[1,"tab-actions"],["mat-stroked-button","",3,"click"],[1,"actividad-timeline"],["class","actividad-item",4,"ngFor","ngForOf","ngForTrackBy"],[1,"actividad-item"],[1,"actividad-icon",3,"ngClass"],[1,"actividad-content"],[1,"actividad-header"],["class","actividad-monto",4,"ngIf"],[1,"actividad-meta"],[1,"actividad-monto"],[1,"no-actividad"],[3,"grupo","esAdministrador"],["text","Cargando grupo..."],[1,"modal-overlay",3,"click"],[1,"modal-content","codigo-modal",3,"click"],[1,"modal-header"],["mat-icon-button","",3,"click"],[1,"modal-body"],[1,"codigo-display"],[1,"codigo-titulo"],[1,"codigo-valor"],[1,"codigo-info"],[1,"codigo-instrucciones"],[1,"modal-actions"],["mat-button","",3,"click"]],template:function(o,a){if(1&o){const _=t.RV6();t.DNE(0,pt,4,2,"div",5)(1,ut,1,0,"ng-template",null,0,t.C5r),t.j41(3,"mat-menu",null,1),t.DNE(5,Ct,4,0,"button",6)(6,Mt,4,0,"button",6),t.nrm(7,"mat-divider"),t.j41(8,"button",7),t.bIt("click",function(){return r.eBV(_),r.Njj(a.refrescarDatos())}),t.j41(9,"mat-icon"),t.EFF(10,"refresh"),t.k0s(),t.EFF(11," Refrescar "),t.k0s()(),t.DNE(12,vt,41,1,"div",8)}if(2&o){const _=t.sdS(2);t.Y8G("ngIf",!a.loading)("ngIfElse",_),t.R7$(5),t.Y8G("ngIf",a.puedeEditarGrupo),t.R7$(),t.Y8G("ngIf",a.puedeInvitarMiembros),t.R7$(6),t.Y8G("ngIf",a.mostrarModalCodigo)}},dependencies:[d.MD,d.YU,d.Sq,d.bT,v.YN,v.me,v.BC,v.vS,g.Hu,g.RN,g.m2,g.MM,g.dh,h.Hl,h.$z,V.M,E.m_,E.An,p.RI,p.$L,p.mq,p.T8,u.YN,u.Jl,u.yZ,u.Jo,C.Cn,C.kk,C.fb,C.Cp,k.Y,P.w,P.q,F.h,F.e,R.M,f.j,f.M,f.g,O.fS,O.fg,I.i,x.N,A.a,T.l,B.ConfiguracionesComponent],styles:[".detalle-grupos-container[_ngcontent-%COMP%]{padding:1rem;height:100vh;overflow:auto}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]{background:#fff;padding:1.5rem;border-radius:8px;box-shadow:0 2px 8px #0000001a;margin-bottom:1rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .grupo-info[_ngcontent-%COMP%]{flex:1}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .grupo-info[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .5rem;font-size:1.5rem;font-weight:500}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .grupo-info[_ngcontent-%COMP%]   .grupo-descripcion[_ngcontent-%COMP%]{color:#0009;margin-bottom:.5rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .grupo-info[_ngcontent-%COMP%]   .grupo-meta[_ngcontent-%COMP%]{display:flex;gap:1rem;color:#0009;font-size:.875rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .grupo-info[_ngcontent-%COMP%]   .grupo-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.25rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .grupo-info[_ngcontent-%COMP%]   .grupo-meta[_ngcontent-%COMP%]   .meta-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:16px;width:16px;height:16px}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .grupo-acciones[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-shrink:0}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]{background:#fff;border-radius:8px;box-shadow:0 2px 8px #0000001a}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]{padding:1.5rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .overview-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;margin-bottom:1.5rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .overview-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]{padding:1rem;text-align:center}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .overview-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-valor[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:600;color:var(--mdc-theme-primary);margin-bottom:.25rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .overview-grid[_ngcontent-%COMP%]   .stat-card[_ngcontent-%COMP%]   .stat-titulo[_ngcontent-%COMP%]{font-size:.875rem;color:#0009}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .miembros-list[_ngcontent-%COMP%]   .miembro-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:1rem;border-bottom:1px solid rgba(0,0,0,.1)}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .miembros-list[_ngcontent-%COMP%]   .miembro-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .miembros-list[_ngcontent-%COMP%]   .miembro-item[_ngcontent-%COMP%]   .miembro-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .miembros-list[_ngcontent-%COMP%]   .miembro-item[_ngcontent-%COMP%]   .miembro-info[_ngcontent-%COMP%]   .miembro-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;background:var(--mdc-theme-primary);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:500}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .miembros-list[_ngcontent-%COMP%]   .miembro-item[_ngcontent-%COMP%]   .miembro-info[_ngcontent-%COMP%]   .miembro-detalles[_ngcontent-%COMP%]   .miembro-nombre[_ngcontent-%COMP%]{font-weight:500;margin-bottom:.25rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .miembros-list[_ngcontent-%COMP%]   .miembro-item[_ngcontent-%COMP%]   .miembro-info[_ngcontent-%COMP%]   .miembro-detalles[_ngcontent-%COMP%]   .miembro-email[_ngcontent-%COMP%]{font-size:.875rem;color:#0009}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .miembros-list[_ngcontent-%COMP%]   .miembro-item[_ngcontent-%COMP%]   .miembro-acciones[_ngcontent-%COMP%]{display:flex;gap:.5rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .configuracion-form[_ngcontent-%COMP%]{max-width:600px}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .configuracion-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]{margin-bottom:1.5rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .configuracion-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500;margin-bottom:1rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .configuracion-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-bottom:1rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .configuracion-form[_ngcontent-%COMP%]   .form-section[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.detalle-grupos-container[_ngcontent-%COMP%]   .loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:400px}@media (max-width: 768px){.detalle-grupos-container[_ngcontent-%COMP%]{padding:.5rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]{padding:1rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-header[_ngcontent-%COMP%]   .header-content[_ngcontent-%COMP%]   .grupo-info[_ngcontent-%COMP%]   .grupo-meta[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]{padding:1rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .overview-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:.5rem}.detalle-grupos-container[_ngcontent-%COMP%]   .grupo-tabs[_ngcontent-%COMP%]   .tab-content[_ngcontent-%COMP%]   .configuracion-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{flex-direction:column;gap:.5rem}}"],changeDetection:0})}return e})()}}]);