"use strict";(self.webpackChunkdividi_facil_front_end=self.webpackChunkdividi_facil_front_end||[]).push([[611],{7611:(Y,m,e)=>{e.r(m),e.d(m,{ListadoNotificacionesComponent:()=>V});var d=e(2200),P=e(1413),l=e(6977),M=e(3236),v=e(1584),I=e(5596),g=e(8834),p=e(1074),f=e(3902),_=e(6471),C=e(1975),h=e(5416),y=e(9183),O=e(1997),E=e(7545),F=e(8776),x=e(9947),k=e(4333),n=e(3664),r=e(8728),b=e(2108),L=e(1782),R=e(9010);function T(o,c){if(1&o&&n.nrm(0,"span",9),2&o){const t=n.XpG();n.Y8G("matBadge",t.notificacionesNoLeidas.length)}}function j(o,c){1&o&&(n.qex(0),n.nrm(1,"app-loading-spinner",10),n.bVm())}function G(o,c){1&o&&(n.qex(0),n.j41(1,"div",11)(2,"mat-icon"),n.EFF(3,"notifications_none"),n.k0s(),n.j41(4,"h2"),n.EFF(5,"No tienes notificaciones"),n.k0s(),n.j41(6,"p"),n.EFF(7,"Cuando tengas actividad en tus grupos, las notificaciones aparecer\xe1n aqu\xed"),n.k0s()(),n.bVm())}function D(o,c){if(1&o){const t=n.RV6();n.j41(0,"mat-list-item",19),n.bIt("click",function(){const a=r.eBV(t).$implicit,s=n.XpG(4);return r.Njj(s.verDetalle(a))}),n.j41(1,"div",20)(2,"div",21)(3,"mat-icon",22),n.EFF(4),n.k0s()(),n.j41(5,"div",23)(6,"div",24)(7,"h3"),n.EFF(8),n.k0s(),n.j41(9,"span",25),n.EFF(10),n.nI1(11,"dateFormat"),n.k0s()(),n.j41(12,"p",26),n.EFF(13),n.k0s(),n.j41(14,"div",27)(15,"mat-chip",22),n.EFF(16),n.k0s()()(),n.j41(17,"div",28)(18,"button",29),n.bIt("click",function(a){const s=r.eBV(t).$implicit;return n.XpG(4).marcarComoLeida(s),r.Njj(a.stopPropagation())}),n.j41(19,"mat-icon"),n.EFF(20,"done"),n.k0s()()()(),n.nrm(21,"mat-divider"),n.k0s()}if(2&o){const t=c.$implicit,i=n.XpG(4);n.R7$(3),n.Y8G("color",i.obtenerColor(t.tipo)),n.R7$(),n.SpI(" ",i.obtenerIcono(t.tipo)," "),n.R7$(4),n.JRh(i.obtenerTitulo(t)),n.R7$(2),n.JRh(n.bMT(11,8,t.fechaCreacion)),n.R7$(3),n.JRh(t.mensaje),n.R7$(2),n.Y8G("color",i.obtenerColor(t.tipo)),n.R7$(),n.SpI(" ",t.tipo.replace("_"," ")," "),n.R7$(2),n.Y8G("disabled",i.procesando)}}function $(o,c){if(1&o&&(n.j41(0,"div",13)(1,"div",14)(2,"mat-icon",15),n.EFF(3,"circle"),n.k0s(),n.EFF(4),n.k0s(),n.j41(5,"div",16)(6,"mat-list",17),n.DNE(7,D,22,10,"mat-list-item",18),n.k0s()()()),2&o){const t=n.XpG(3);n.R7$(4),n.SpI(" No Le\xeddas (",t.notificacionesNoLeidas.length,") "),n.R7$(3),n.Y8G("ngForOf",t.notificacionesNoLeidas)("ngForTrackBy",t.trackByNotificacion)}}function A(o,c){if(1&o){const t=n.RV6();n.j41(0,"mat-list-item",31),n.bIt("click",function(){const a=r.eBV(t).$implicit,s=n.XpG(4);return r.Njj(s.verDetalle(a))}),n.j41(1,"div",20)(2,"div",21)(3,"mat-icon",32),n.EFF(4),n.k0s()(),n.j41(5,"div",23)(6,"div",24)(7,"h3"),n.EFF(8),n.k0s(),n.j41(9,"span",25),n.EFF(10),n.nI1(11,"dateFormat"),n.k0s()(),n.j41(12,"p",26),n.EFF(13),n.k0s(),n.j41(14,"div",27)(15,"mat-chip",33),n.EFF(16),n.k0s()()()(),n.nrm(17,"mat-divider"),n.k0s()}if(2&o){const t=c.$implicit,i=n.XpG(4);n.R7$(4),n.SpI(" ",i.obtenerIcono(t.tipo)," "),n.R7$(4),n.JRh(i.obtenerTitulo(t)),n.R7$(2),n.JRh(n.bMT(11,5,t.fechaCreacion)),n.R7$(3),n.JRh(t.mensaje),n.R7$(3),n.SpI(" ",t.tipo.replace("_"," ")," ")}}function B(o,c){if(1&o&&(n.j41(0,"div",13)(1,"div",14)(2,"mat-icon"),n.EFF(3,"done"),n.k0s(),n.EFF(4),n.k0s(),n.j41(5,"div",16)(6,"mat-list",17),n.DNE(7,A,18,7,"mat-list-item",30),n.k0s()()()),2&o){const t=n.XpG(3);n.R7$(4),n.SpI(" Le\xeddas (",t.notificacionesLeidas.length,") "),n.R7$(3),n.Y8G("ngForOf",t.notificacionesLeidas)("ngForTrackBy",t.trackByNotificacion)}}function S(o,c){if(1&o&&n.DNE(0,$,8,3,"div",12)(1,B,8,3,"div",12),2&o){const t=n.XpG(2);n.Y8G("ngIf",t.notificacionesNoLeidas.length>0),n.R7$(),n.Y8G("ngIf",t.notificacionesLeidas.length>0)}}function U(o,c){if(1&o&&n.DNE(0,G,8,0,"ng-container",8)(1,S,2,2,"ng-template",null,1,n.C5r),2&o){const t=n.sdS(2),i=n.XpG();n.Y8G("ngIf",0===i.notificaciones.length)("ngIfElse",t)}}let V=(()=>{class o{notificacionService;router;snackBar;authService;destroy$=new P.B;loading=!1;procesando=!1;notificaciones=[];notificacionesNoLeidas=[];notificacionesLeidas=[];idUsuario;constructor(t,i,a,s){this.notificacionService=t,this.router=i,this.snackBar=a,this.authService=s}ngOnInit(){const t=this.authService.obtenerUsuario();t?(this.idUsuario=t.idUsuario,this.cargarNotificaciones(),this.iniciarPolling()):this.snackBar.open("No se pudo obtener el usuario actual","Cerrar",{duration:3e3})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}cargarNotificaciones(){this.loading=!0,this.notificacionService.obtenerPendientes(this.idUsuario).pipe((0,l.Q)(this.destroy$)).subscribe({next:t=>{this.loading=!1,t.exito&&t.data&&(this.notificaciones=t.data,this.separarNotificaciones())},error:t=>{this.loading=!1,console.error("Error al cargar notificaciones:",t),this.snackBar.open("Error al cargar notificaciones","Cerrar",{duration:3e3})}})}separarNotificaciones(){this.notificacionesNoLeidas=this.notificaciones.filter(t=>"LEIDA"!==t.estado&&"Leida"!==t.estado),this.notificacionesLeidas=this.notificaciones.filter(t=>"LEIDA"===t.estado||"Leida"===t.estado)}iniciarPolling(){(function N(o=0,c=M.E){return o<0&&(o=0),(0,v.O)(o,o,c)})(3e4).pipe((0,l.Q)(this.destroy$)).subscribe(()=>{this.procesando||this.cargarNotificacionesSilencioso()})}cargarNotificacionesSilencioso(){this.notificacionService.obtenerPendientes(this.idUsuario).pipe((0,l.Q)(this.destroy$)).subscribe({next:t=>{if(t.exito&&t.data){const i=t.data.length,a=this.notificaciones.length;this.notificaciones=t.data,this.separarNotificaciones(),i>a&&this.snackBar.open("\xa1Tienes nuevas notificaciones!","Ver",{duration:3e3,panelClass:["success-snackbar"]})}},error:t=>{console.error("Error en polling de notificaciones:",t)}})}marcarComoLeida(t){"LEIDA"===t.estado||"Leida"===t.estado||(this.procesando=!0,this.notificacionService.marcarComoLeida(t.idNotificacion,this.idUsuario).pipe((0,l.Q)(this.destroy$)).subscribe({next:i=>{this.procesando=!1,i.exito&&(t.estado="LEIDA",this.separarNotificaciones(),this.snackBar.open("Notificaci\xf3n marcada como le\xedda","Cerrar",{duration:2e3}))},error:i=>{this.procesando=!1,console.error("Error al marcar notificaci\xf3n:",i),this.snackBar.open("Error al marcar notificaci\xf3n","Cerrar",{duration:3e3})}}))}marcarTodasComoLeidas(){if(0===this.notificacionesNoLeidas.length)return;this.procesando=!0;const t=this.notificacionesNoLeidas.map(i=>this.notificacionService.marcarComoLeida(i.idNotificacion,this.idUsuario).toPromise());Promise.all(t).then(()=>{this.procesando=!1,this.cargarNotificaciones(),this.snackBar.open("Todas las notificaciones marcadas como le\xeddas","Cerrar",{duration:3e3,panelClass:["success-snackbar"]})}).catch(i=>{this.procesando=!1,console.error("Error al marcar todas:",i),this.snackBar.open("Error al marcar notificaciones","Cerrar",{duration:3e3})})}verDetalle(t){"LEIDA"!==t.estado&&this.marcarComoLeida(t),this.navegarPorTipo(t)}navegarPorTipo(t){switch(t.tipo){case"GASTO_CREADO":this.router.navigate(["/gastos"],{queryParams:{grupo:t.idGrupo}});break;case"PAGO_RECIBIDO":case"PAGO_SOLICITADO":this.router.navigate(["/pagos"],{queryParams:{grupo:t.idGrupo}});break;case"GRUPO_INVITACION":this.router.navigate(["/grupos/detalle"],{queryParams:{id:t.idGrupo}});break;default:this.router.navigate(["/notificaciones/detalle"],{queryParams:{id:t.idNotificacion}})}}obtenerIcono(t){return{GASTO_CREADO:"receipt",PAGO_RECIBIDO:"payments",PAGO_SOLICITADO:"payment",RECORDATORIO:"schedule",GRUPO_INVITACION:"group_add"}[t]||"notifications"}obtenerColor(t){return{GASTO_CREADO:"primary",PAGO_RECIBIDO:"accent",PAGO_SOLICITADO:"warn",RECORDATORIO:"primary",GRUPO_INVITACION:"accent"}[t]||"primary"}obtenerTitulo(t){return{GASTO_CREADO:"Nuevo Gasto",PAGO_RECIBIDO:"Pago Recibido",PAGO_SOLICITADO:"Solicitud de Pago",RECORDATORIO:"Recordatorio",GRUPO_INVITACION:"Invitaci\xf3n a Grupo"}[t.tipo]||"Notificaci\xf3n"}recargar(){this.cargarNotificaciones()}trackByNotificacion(t,i){return i.idNotificacion}static \u0275fac=function(i){return new(i||o)(n.rXU(b.c),n.rXU(L.Ix),n.rXU(h.UG),n.rXU(E.u))};static \u0275cmp=n.VBU({type:o,selectors:[["app-listado"]],decls:20,vars:5,consts:[["notificacionesContent",""],["listaNotificaciones",""],[1,"notificaciones-container"],["card-header",""],["class","contador","matBadgeColor","warn",3,"matBadge",4,"ngIf"],["mat-button","",3,"click","disabled"],["mat-raised-button","","color","primary",3,"click","disabled"],["card-content",""],[4,"ngIf","ngIfElse"],["matBadgeColor","warn",1,"contador",3,"matBadge"],["text","Cargando notificaciones..."],[1,"empty-state"],["class","notificaciones-section",4,"ngIf"],[1,"notificaciones-section"],[1,"section-header"],["color","warn"],[1,"section-content"],[1,"notificaciones-list"],["class","notificacion-item no-leida",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"notificacion-item","no-leida",3,"click"],[1,"notificacion-content"],[1,"notificacion-icon"],[3,"color"],[1,"notificacion-info"],[1,"notificacion-header"],[1,"fecha"],[1,"mensaje"],[1,"notificacion-meta"],[1,"notificacion-actions"],["mat-icon-button","","title","Marcar como le\xedda",3,"click","disabled"],["class","notificacion-item leida",3,"click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"notificacion-item","leida",3,"click"],["color","disabled"],["color","primary","disabled",""]],template:function(i,a){if(1&i){const s=n.RV6();n.j41(0,"div",2)(1,"app-card"),n.qex(2,3),n.j41(3,"mat-icon"),n.EFF(4,"notifications"),n.k0s(),n.j41(5,"span"),n.EFF(6,"Notificaciones"),n.k0s(),n.DNE(7,T,1,1,"span",4),n.j41(8,"button",5),n.bIt("click",function(){return r.eBV(s),r.Njj(a.recargar())}),n.j41(9,"mat-icon"),n.EFF(10,"refresh"),n.k0s(),n.EFF(11," Actualizar "),n.k0s(),n.j41(12,"button",6),n.bIt("click",function(){return r.eBV(s),r.Njj(a.marcarTodasComoLeidas())}),n.j41(13,"mat-icon"),n.EFF(14,"done_all"),n.k0s(),n.EFF(15," Marcar Todas Le\xeddas "),n.k0s(),n.bVm(),n.qex(16,7),n.DNE(17,j,2,0,"ng-container",8)(18,U,3,2,"ng-template",null,0,n.C5r),n.bVm(),n.k0s()()}if(2&i){const s=n.sdS(19);n.R7$(7),n.Y8G("ngIf",a.notificacionesNoLeidas.length>0),n.R7$(),n.Y8G("disabled",a.loading||a.procesando),n.R7$(4),n.Y8G("disabled",0===a.notificacionesNoLeidas.length||a.procesando),n.R7$(5),n.Y8G("ngIf",a.loading)("ngIfElse",s)}},dependencies:[d.MD,d.Sq,d.bT,I.Hu,g.Hl,g.$z,R.M,p.m_,p.An,f.Fg,f.jt,f.YE,O.q,_.YN,_.Jl,C.Y,C.k,h._T,y.D6,O.w,F.a,x.i,k.N],styles:['@charset "UTF-8";.notificaciones-container[_ngcontent-%COMP%]{max-width:1000px;margin:0 auto;padding:1rem}.header-section[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;flex-wrap:wrap;gap:1rem}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin:0;color:#333}.header-section[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]   .contador[_ngcontent-%COMP%]{position:relative}.header-section[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{display:flex;gap:1rem;align-items:center}.notificaciones-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.empty-state[_ngcontent-%COMP%]   .empty-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:3rem;text-align:center}.empty-state[_ngcontent-%COMP%]   .empty-content[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:4rem;width:4rem;height:4rem;color:#ccc;margin-bottom:1rem}.empty-state[_ngcontent-%COMP%]   .empty-content[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#666;margin:0 0 .5rem}.empty-state[_ngcontent-%COMP%]   .empty-content[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#999;margin:0;max-width:400px}.notificaciones-section[_ngcontent-%COMP%]   mat-card-header[_ngcontent-%COMP%]   mat-card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;font-size:1.2rem}.notificaciones-list[_ngcontent-%COMP%]{padding:0}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]{padding:0;height:auto;cursor:pointer;transition:background-color .2s ease}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item.no-leida[_ngcontent-%COMP%]{background-color:#fff3e0;border-left:4px solid #ff9800}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item.no-leida[_ngcontent-%COMP%]:hover{background-color:#ffecb3}.notificaciones-list[_ngcontent-%COMP%]   .notificacion-item.leida[_ngcontent-%COMP%]{opacity:.7}.notificacion-content[_ngcontent-%COMP%]{display:flex;align-items:flex-start;width:100%;padding:1rem;gap:1rem}.notificacion-content[_ngcontent-%COMP%]   .notificacion-icon[_ngcontent-%COMP%]{flex-shrink:0;display:flex;align-items:center;justify-content:center;width:48px;height:48px;border-radius:50%;background-color:#f5f5f5}.notificacion-content[_ngcontent-%COMP%]   .notificacion-icon[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;width:24px;height:24px}.notificacion-content[_ngcontent-%COMP%]   .notificacion-info[_ngcontent-%COMP%]{flex:1;min-width:0}.notificacion-content[_ngcontent-%COMP%]   .notificacion-info[_ngcontent-%COMP%]   .notificacion-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:.5rem;gap:1rem}.notificacion-content[_ngcontent-%COMP%]   .notificacion-info[_ngcontent-%COMP%]   .notificacion-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1rem;font-weight:500;color:#333}.notificacion-content[_ngcontent-%COMP%]   .notificacion-info[_ngcontent-%COMP%]   .notificacion-header[_ngcontent-%COMP%]   .fecha[_ngcontent-%COMP%]{font-size:.8rem;color:#666;white-space:nowrap}.notificacion-content[_ngcontent-%COMP%]   .notificacion-info[_ngcontent-%COMP%]   .mensaje[_ngcontent-%COMP%]{margin:0 0 .75rem;color:#555;line-height:1.4;font-size:.9rem}.notificacion-content[_ngcontent-%COMP%]   .notificacion-info[_ngcontent-%COMP%]   .notificacion-meta[_ngcontent-%COMP%]{display:flex;gap:.5rem;align-items:center}.notificacion-content[_ngcontent-%COMP%]   .notificacion-actions[_ngcontent-%COMP%]{flex-shrink:0;display:flex;align-items:center}.notificacion-content[_ngcontent-%COMP%]   .notificacion-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{opacity:.7;transition:opacity .2s ease}.notificacion-content[_ngcontent-%COMP%]   .notificacion-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{opacity:1}@media (max-width: 768px){.notificaciones-container[_ngcontent-%COMP%]{padding:.5rem}.header-section[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.header-section[_ngcontent-%COMP%]   .header-actions[_ngcontent-%COMP%]{justify-content:center}.notificacion-content[_ngcontent-%COMP%]{padding:.75rem}.notificacion-content[_ngcontent-%COMP%]   .notificacion-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:.25rem}.notificacion-content[_ngcontent-%COMP%]   .notificacion-actions[_ngcontent-%COMP%]{display:none}}.spinning[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}[_nghost-%COMP%]{contain:layout style paint;display:block}.dashboard-container[_ngcontent-%COMP%], .stats-container[_ngcontent-%COMP%], .actions-grid[_ngcontent-%COMP%], .timeline-list[_ngcontent-%COMP%]{transform:translateZ(0);will-change:transform}mat-card[_ngcontent-%COMP%]{backface-visibility:hidden}.dashboard-container[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInUp .3s ease-out}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}']})}return o})()}}]);